(()=>{"use strict";function e(e){e.classList.add("hide"),setTimeout((()=>{e.classList.add("hide-display")}),500)}function t(e){e.classList.add("hide"),e.classList.add("hide-display")}function s(e){setTimeout((()=>{e.classList.remove("hide"),e.classList.add("show"),e.classList.remove("hide-display")}),500)}function r(e){e.classList.remove("hide"),e.classList.remove("hide-display"),e.classList.add("show")}function i(e,t){let s=localStorage.getItem(e);return null!=s&&null!=s?JSON.parse(s):t}function n(e,t){localStorage.setItem(e,JSON.stringify(t))}function o(e,t){const s=new Image;s.src=t,s.onload=()=>{e.style.backgroundImage="url("+s.src+")"}}const c=class{constructor(e,t,s,r){this.picture=e,this.author=t,this.imageNum=s,this.year=r}showInfoPage(t,s=!0){let i=document.querySelector(".infopage-section");r(i),i.classList.add("moveUp");let n=i.querySelector(".image-info"),c=i.querySelector(".info-author"),l=i.querySelector(".info-picture"),a=i.querySelector(".info-year"),u=getComputedStyle(i);if(n.style.backgroundImage='url("./assets/images/blank.PNG")',o(i.querySelector(".resultIndicator"),"yes"==t?"./assets/icons/right.png":"./assets/icons/wrong.png"),o(n,`https://raw.githubusercontent.com/Dairin-dei/art-quiz-images/master/img/${this.imageNum}.jpg`),u=getComputedStyle(n),n.style.height=u.width,c.innerHTML=this.author,l.innerHTML=`"${this.picture}"`,a.innerHTML=`${this.year}г.`,!s){let t=i.querySelector(".continue");t.innerHTML="Понятно!",t.addEventListener("click",(()=>{i.classList.remove("moveUp"),e(i)}))}}};let l;const a=class{constructor(e,t,s){this.type=e,this.picture=new c(t.name,t.author,t.imageNum,t.year),"picture"==e?(this.section=document.querySelector(".picture-quiz-section"),this.correctAnswer=t.author,this.answers=this.defineAnswers(t.author,s)):(this.section=document.querySelector(".artist-quiz-section"),this.correctAnswer=t.imageNum,this.answers=this.defineAnswers(t.imageNum,s)),this.isCorrect="notAnswered",this.domAnswers=[]}defineAnswers(e,t){let s=[],r=0;for(;r<3;){const i=Math.floor(Math.random()*t.length);"picture"==this.type?t[i].trim()!=e.trim()&&(s.includes(t[i])||(s.push(t[i].trim()),r++)):t[i].author==this.picture.author||t[i].imageNum==e||s.includes(t[i].imageNum)||(s.push(t[i].imageNum),r++)}return s.push(this.correctAnswer),s.sort((()=>Math.random()-.5)),s}renderPicture(e){try{clearInterval(l)}finally{this.setClass=e;const t=this.section.querySelector(".picture-image"),s=this.section.querySelector(".picture-answers-wrapper"),r=s.querySelectorAll(".picture-answer");o(t,`https://raw.githubusercontent.com/Dairin-dei/art-quiz-images/master/img/${this.picture.imageNum}.jpg`),r.forEach((e=>{e.remove()})),this.domAnswers=[];for(let e=0;e<4;e++){let t=document.createElement("div");t.classList.add("picture-answer"),t.classList.add("font-answer"),t.innerHTML=this.answers[e],s.append(t),t.addEventListener("click",(()=>this.afterClick(e))),this.domAnswers.push(t)}this.setClass.timerOn?this.engageTimer():this.section.querySelector(".timer-count").innerHTML=""}}renderArtist(e){try{clearInterval(l)}finally{this.setClass=e,this.section.querySelector(".artist-quiz-question").innerHTML=`Которую из этих картин написал ${this.picture.author}?`}const t=this.section.querySelector(".artist-answers-wrapper");t.querySelectorAll(".artist-answer").forEach((e=>{e.remove()})),this.domAnswers=[];for(let e=0;e<4;e++){let s=document.createElement("div");s.classList.add("artist-answer"),s.classList.add("font-answer"),o(s,`https://raw.githubusercontent.com/Dairin-dei/art-quiz-images/master/img/${this.answers[e]}.jpg`),s.addEventListener("click",(()=>this.afterClick(e))),t.append(s),this.domAnswers.push(s)}this.setClass.timerOn?this.engageTimer():this.section.querySelector(".timer-count").innerHTML=""}afterClick(e){"picture"==this.type?this.correctAnswer==this.answers[e]?(this.domAnswers[e].classList.add("animated"),this.domAnswers[e].style.backgroundColor="#10965e",this.domAnswers[e].style.color="#ffffff",this.rightAnswer()):(this.domAnswers[e].classList.add("animated"),this.domAnswers[e].style.backgroundColor="#cf170a",this.domAnswers[e].style.color="#000000",this.wrongAnswer()):this.correctAnswer==this.answers[e]?(this.domAnswers[e].classList.add("artist-answer-right"),this.rightAnswer()):(this.domAnswers[e].classList.add("artist-answer-wrong"),this.wrongAnswer()),this.picture.showInfoPage(this.isCorrect,!0)}rightAnswer(){try{clearInterval(l)}finally{this.isCorrect="yes",this.setClass.soundOn&&this.setClass.playAudio(this.setClass.rightAnswerSound)}}wrongAnswer(){try{clearInterval(l)}finally{this.isCorrect="no",this.setClass.soundOn&&this.setClass.playAudio(this.setClass.wrongAnswerSound)}}wrongInfoPage(){this.picture.showInfoPage("no",!0),console.log("wrongInfoPage")}engageTimer(){const e=this.section.querySelector(".timer-count");let t=`00:${this.setClass.timerCount.toString().padStart(2,"0")}`;e.innerHTML=t;let s=this.setClass.timerCount-1,r=this.wrongAnswer.bind(this),i=this.wrongInfoPage.bind(this);this.section.classList.contains("hide")||(l=setInterval((function(){if(s<=0)clearInterval(l),r(),i();else{let t=`00:${s.toString().padStart(2,"0")}`;e.innerHTML=t}h?clearInterval(l):--s}),1e3))}};let u,d=!1;let h=!1;new class{constructor(){this.settingsForm=document.querySelector(".settings-section"),this.quiz={},this.stop=!1,this.tuning=new class{constructor(){let e=i("ddSoundOn","");this.soundOn=!!e;let t=document.querySelector(".sound-settings").querySelector(".btn-sound");this.soundOn&&this.soundOnOff(t),this.rightAnswerSound=this.getAudio("right"),this.wrongAnswerSound=this.getAudio("wrong"),this.endSound=this.getAudio("end");let s=i("ddSoundLevel","-1");this.soundLevel=Number(s)>0?Number(s):50,this.setListenerOnCloseSettings(),t.addEventListener("click",(()=>{this.soundOnOff(t,this.domLevelSound)}));let r=i("ddTimerOn","false");this.timerOn=1==r,document.querySelector(".time-settings").querySelector(".id-timer").addEventListener("click",(()=>{this.timerOnOff()}));let n=i("ddTimerCount","-1");this.timerCount=Number(n)>0?n:10}showTuning(){r(document.querySelector(".settings-section")),this.displaySoundSettings(),this.displayTimerSettings()}displaySoundSettings(){let e=document.querySelector(".sound-settings");this.domLevelSound=e.querySelector(".soundlevel"),this.domLevelSound.value=this.soundLevel,this.domLevelSound.addEventListener("input",(()=>{this.changeSoundlevel(this.domLevelSound)})),this.setInputColor(this.domLevelSound,this.domLevelSound.value)}getAudio(e){let t=new Audio;return t.src=`./assets/sound/${e}.mp3`,t}setInputColor(e,t){e.style.background=`linear-gradient(\n          to right,\n          var(--color-violet) ${String(t)}%,\n          var(--color-violet) ${String(t)}%,\n          var(--color-milk) ${t}%,\n          var(--color-milk) 100%)`}changeSoundlevel(e){this.soundLevel=e.value,this.setInputColor(e,e.value),n("ddSoundLevel",e.value)}soundOnOff(e){e.classList.toggle("mute"),e.classList.toggle("sound"),this.soundOn=e.classList.contains("sound"),n("ddSoundOn",e.classList.contains("sound"))}setListenerOnCloseSettings(){let e=document.querySelector(".settings-section");e.querySelector(".close-window").addEventListener("click",(()=>{t(e)}))}playAudio(e){e.volume=this.soundLevel/100,e.play()}stopAudio(e){e.pause(),e.currentTime=0}displayTimerSettings(){let e=document.querySelector(".time-settings");e.querySelector(".id-timer").checked=this.timerOn,this.domTimerCount=e.querySelector(".timer-count"),this.domTimerCount.value=this.setValueSomTimer(this.timerCount),this.domTimerCount.addEventListener("input",(()=>{this.changeTimerCount(this.domTimerCount)})),this.setInputColor(this.domTimerCount,this.domTimerCount.value)}setValueSomTimer(e){return 5==e?5:10==e?23:15==e?41:20==e?59:30==e?77:95}changeTimerCount(e){let t=e.value;t<=15?(this.timerCount=5,t=5):t<=30?(this.timerCount=10,t=23):t<=50?(this.timerCount=15,t=41):t<=70?(this.timerCount=20,t=59):t<=85?(this.timerCount=25,t=77):(this.timerCount=30,t=95),e.value=t,this.setInputColor(e,e.value),n("ddTimerCount",this.timerCount)}timerOnOff(){let e=document.querySelector(".id-timer");this.timerOn=e.checked,n("ddTimerOn",this.timerOn),this.displayTimerSettings()}},this.setSettings()}setSettings(){let e=document.querySelector(".main-section"),s=e.querySelector(".button-main-picture"),i=e.querySelector(".button-main-artist"),n=document.querySelector(".icon-home"),o=document.querySelector(".icon-categories"),c=e.querySelector(".button-main-settings"),l=document.querySelector("footer");s.addEventListener("click",(()=>{this.type="picture",this.quiz={};try{clearInterval(a)}finally{this.showCategories(this.type)}})),i.addEventListener("click",(()=>{this.type="artist",this.quiz={};try{clearInterval(a)}finally{this.showCategories(this.type)}})),n.addEventListener("click",(()=>{let s=document.querySelectorAll(".section");h=!0,document.querySelector(".continue").removeEventListener("click",u);try{clearInterval(a)}finally{s.forEach((e=>{t(e)}))}t(n.parentNode),r(e),r(l)})),c.addEventListener("click",(()=>{this.setTuning()})),o.addEventListener("click",(()=>{h=!0;try{a&&clearInterval(a),clearInterval(a)}finally{document.querySelector(".continue").removeEventListener("click",u),t(l),document.querySelectorAll(".section").forEach((e=>{t(e)})),this.showCategories(this.type)}}))}showCategories(i){this.type=i;let n=document.querySelector(".category-section"),o=n.querySelectorAll(".category");o.forEach((e=>{e.remove()}));for(let e=0;e<12;e++){let t=document.createElement("div");t.classList.add("category","wrapper-horizontal","less-opacity","move-down");let s=(e+1).toString().padStart(2,"0");t.style.backgroundImage=`url('./assets/images/categories/${s}${this.type}.PNG')`,n.append(t);let r=document.createElement("h3");r.classList.add("category-name","h3"),t.append(r),r.innerHTML=s;let i=document.createElement("h4");i.classList.add("category-result","h4"),t.append(i),i.innerHTML="0 / 10"}!function(){let i=document.querySelector(".main-section"),n=i.querySelector(".button-main-picture"),o=i.querySelector(".button-main-artist"),c=i.querySelector(".button-main-settings"),l=document.querySelector(".header"),a=document.querySelector(".footer"),u=document.querySelector(".category-section"),d=u.querySelectorAll(".category");if(i.classList.contains("hide")){r(l),r(u);for(let e=0;e<d.length;e++)setTimeout((()=>{d[e].classList.remove("move-down")}),150*e)}else o.classList.add("move-left"),n.classList.add("move-right"),c.classList.add("move-down"),e(a),setTimeout((()=>{t(i),o.classList.remove("move-left"),n.classList.remove("move-right"),c.classList.remove("move-down"),r(l),r(u);for(let e=0;e<d.length;e++)setTimeout((()=>{d[e].classList.remove("move-down")}),250*e)}),1500);setTimeout((()=>{s(a)}),2e3)}(),o=n.querySelectorAll(".category"),o.forEach(((e,t)=>{e.addEventListener("click",(()=>this.chooseCategory(e))),e.addEventListener("showOnScreen",(()=>this.changeCategoryResults(t+1,e)));let s=new Event("showOnScreen");e.dispatchEvent(s),e.querySelector(".category-result").addEventListener("click",(e=>{e.stopPropagation(),this.showDetailedResult(t)}))}))}async chooseCategory(i){i.classList.add("downscale");let o=Number(i.querySelector(".category-name").innerHTML);this.category=o;let c=await this.getDataFile();this.data=c;let l=document.querySelector(".category-section");i.classList.remove("downscale");let m=l.querySelectorAll(".category"),g=l.querySelector("h2");g.classList.add("move-down");for(let e=0;e<m.length;e++)setTimeout((()=>{m[e].classList.add("move-down")}),100*e);setTimeout((()=>{g.classList.remove("move-down"),t(l),h=!1,this.quiz=new class{constructor(t,s,i,n){let o=document.querySelector(".category-section");this.currentQuiz=s,this.type=t,this.setClass=n,d=!1,u=this.finishInfoSection.bind(this),"picture"===this.type?this.domCurrentQuiz=document.querySelector(".picture-quiz-section"):this.domCurrentQuiz=document.querySelector(".artist-quiz-section"),this.arrAnswers=this.getAnswers(i),this.arrQuestions=this.convertToClass(this.getQuestions(i),"picture"==this.type?this.arrAnswers:i),this.answeredQuestions=0,e(o),this.renderIndicators(),r(this.domCurrentQuiz),this.setListenerOnContinue(),this.setListenerOnCloseResult(),this.renderNextQuestion()}getQuestions(e){let t,s=[];t="artist"==this.type?10*(this.currentQuiz-1):120+10*(this.currentQuiz-1);for(let r=t;r<t+10;r++)s.push(e[r]);return s}setListenerOnContinue(){document.querySelector(".continue").addEventListener("click",u)}finishInfoSection(){console.log("finishInfoSection",this.answeredQuestions);let t=document.querySelector(".infopage-section");e(t),t.classList.remove("moveUp"),this.answeredQuestions++,this.renderNextQuestion(),this.renderIndicators(),this.setClass.soundOn&&(this.setClass.stopAudio(this.setClass.rightAnswerSound),this.setClass.stopAudio(this.setClass.wrongAnswerSound))}getAnswers(e){let t=[];if("picture"==this.type)for(let s=0;s<e.length;s++)t.push(e[s].author);return t}convertToClass(e,t){let s=[];return e.forEach((e=>{let r=new a(this.type,e,t);s.push(r)})),s}renderNextQuestion(){if(!h)if(10==this.answeredQuestions){this.renderIndicators(),this.getResultAndSetToLocalStorage(),this.renewCategoryResult(),e(this.domCurrentQuiz);let t=document.querySelector(".round-result-section"),r=document.querySelector(".category-section").querySelectorAll(".category");s(document.querySelector(".category-section"));for(let e=0;e<r.length;e++)setTimeout((()=>{r[e].classList.remove("move-down")}),250*e);s(t),this.setClass.soundOn&&this.setClass.playAudio(this.setClass.endSound),document.querySelector(".continue").removeEventListener("click",u),d=!0}else if(!h){let e=this.arrQuestions[this.answeredQuestions];"picture"==this.type?e.renderPicture(this.setClass):e.renderArtist(this.setClass)}}renderIndicators(){let e=this.domCurrentQuiz.querySelector(".indicators"),t=e.querySelectorAll(".indicator");if(1==t.length)for(let s=1;s<10;s++){let s=t[0].cloneNode();e.append(s)}else this.arrQuestions.forEach(((e,s)=>{"yes"==e.isCorrect?t[s].classList.add("correctIndicator"):"no"==e.isCorrect?t[s].classList.add("wrongIndicator"):(t[s].classList.remove("correctIndicator"),t[s].classList.remove("wrongIndicator"))}))}getResultAndSetToLocalStorage(){let e=[],t=document.querySelector(".round-result");this.arrQuestions.forEach((t=>{"yes"==t.isCorrect?e.push(1):e.push(0)})),n(`dd${this.type}Category${this.currentQuiz}played`,!0);let s=e.reduce(((e,t)=>e+t),0);t.innerHTML=`${s.toString()} / 10`,n(`dd${this.type}${this.currentQuiz.toString()}`,e),n(`dd${this.type}Category${this.currentQuiz}Result`,s)}renewCategoryResult(){document.querySelectorAll(".category")[this.currentQuiz-1].dispatchEvent(new Event("showOnScreen"))}setListenerOnCloseResult(){let t=document.querySelector(".round-result-section");t.querySelector(".go-back").addEventListener("click",(()=>e(t)))}}(this.type,this.category,this.data,this.tuning)}),1500)}async getDataFile(){try{const e="./assets/images/images.json",t=await fetch(e),s=await t.json();return Promise.resolve(s)}catch(e){alert(e)}}changeCategoryResults(e,t){let s=localStorage.getItem(`dd${this.type}Category${e}Result`),r=t.querySelector(".category-result");null!=s&&null!=s?(r.innerHTML=`${s} / 10`,r.parentNode.classList.remove("less-opacity")):r.innerHTML="0 / 10"}async showDetailedResult(t){if(null==this.data){let e=await this.getDataFile();this.data=e}e(document.querySelector(".category-section"));let n=document.querySelector(".category-result-section"),l=new class{constructor(e,t,s){this.type=e,this.categoryNumber=t+1,this.deletePrevious(),this.arrResults=this.getResultsFromLocalStorage(),this.pictures=this.getInfoAboutPictures(s,this.arrResults),null!=this.arrResults&&this.showResults(),this.setEventListenerOnBackFromResult()}getResultsFromLocalStorage(){return null==i(`dd${this.type}Category${this.categoryNumber}Result`,null)?[]:i(`dd${this.type}${this.categoryNumber}`,[])}getInfoAboutPictures(e,t){let s=[];return t.forEach(((t,r)=>{let i;i="artist"==this.type?10*(this.categoryNumber-1)+r:120+10*(this.categoryNumber-1)+r;let n=e[i];s.push(new c(n.name,n.author,n.imageNum,n.year))})),s}showResults(){document.querySelector(".header-results").textContent=`Результаты ${this.categoryNumber} раунда`;let e=document.querySelector(".result-wrapper");this.arrResults.forEach(((t,s)=>{setTimeout((()=>{let r=document.createElement("div");o(r,`https://raw.githubusercontent.com/Dairin-dei/art-quiz-images/master/img/${this.pictures[s].imageNum}.jpg`),e.append(r),r.classList.add("result-item"),0===t&&r.classList.add("not-solved"),r.addEventListener("click",(()=>{this.pictures[s].showInfoPage("yes",!1)}))}),300*s)}))}setEventListenerOnBackFromResult(){document.querySelector(".header-results").addEventListener("click",(()=>{e(document.querySelector(".category-result-section")),s(document.querySelector(".category-section"))}))}deletePrevious(){document.querySelectorAll(".result-item").forEach((e=>{e.remove()}))}}(this.type,t,this.data);console.log(l),r(n)}setTuning(){this.tuning.showTuning()}}})();